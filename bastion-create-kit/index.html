<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>1단계: Bastion VM 생성기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 4.5rem; background-color: #f4f4f4; }
        .container { max-width: 800px; }
        .card { margin-bottom: 1.5rem; }
        .card-header { font-weight: bold; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">🚀 1단계: RHEL 9.6 Bastion VM 생성</a>
        </div>
    </nav>

    <main class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- 0단계 -->
        <div class="card">
            <div class="card-header">0단계: 다운로드 링크 준비</div>
            <div class="card-body">
                <p class="card-text">
                    아래 버튼을 눌러 Red Hat 다운로드 페이지를 새 탭에서 엽니다. 로그인 후,
                    <b>"Red Hat Enterprise Linux 9.6 Binary DVD"</b>의 다운로드 링크 주소를 복사하세요.
                </p>
                <a href="https://access.redhat.com/downloads/content/rhel" target="_blank" class="btn btn-info">Red Hat 다운로드 페이지 열기</a>
            </div>
        </div>

        <!-- 1단계 Form -->
        <form method="post">
            <div class="card">
                <div class="card-header">1단계: RHEL 9.6 이미지 다운로드</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="iso_url_from_user" class="form-label">복사한 다운로드 링크 붙여넣기</label>
                        <input type="url" class="form-control" id="iso_url_from_user" name="iso_url_from_user" placeholder="https://access.cdn.redhat.com/..." required>
                        <div class="form-text">0단계에서 복사한 임시 다운로드 링크를 여기에 붙여넣으세요.</div>
                    </div>
                    <button type="submit" name="action" value="download_iso" class="btn btn-primary">붙여넣은 링크로 이미지 다운로드</button>
                </div>
            </div>
        </form>
        
        <!-- 2단계 Form -->
        <form method="post">
            <div class="card">
                <div class="card-header">2단계: Kickstart 파일 생성</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="root_password" class="form-label">Root 비밀번호</label>
                        <input type="password" class="form-control" id="root_password" name="root_password" placeholder="#는 주석으로 처리되므로 사용금지" required>
                    </div>
                    <div class="mb-3">
                        <label for="hostname" class="form-label">VM 호스트명</label>
                        <input type="text" class="form-control" id="hostname" name="hostname" placeholder="bastion.example.com" required>
                    </div>
		    <div class="mb-3">
			<label for="bastion" class="form-label">HOST IP</label>
			<input type="text" class="form-control" id="host_ip" name="host_ip" placeholder="호스트의 IP를 입력하세요." required>
		    </div>
		    <div class="mb-3">
			<label for="bastion_ip" class="form-label">BASTION IP</label>
			<input type="text" class="form-control" id="bastion_ip" name="bastion_ip" placeholder="Bastion의 IP를 입력하세요." required>
		    </div>
                    <button type="submit" name="action" value="generate_kickstart" class="btn btn-success">Kickstart 파일 생성</button>
                </div>
            </div>
        </form>

        <!-- 3단계 Form -->
        <form method="post">
            <div class="card">
                <div class="card-header">3단계: Bastion VM 생성</div>
                <div class="card-body">
                    <!--  [수정] vCPUs, RAM, Disk Size 드롭다운 추가 -->
		    <div class="mb-3">
			<label for="vm_name" class="form-label">Bastion VM 이름</label> 
			<input type="text" class="form-control" id="vm_name" name="vm_name" placeholder="VM의 이름을 입력하세요" required>
		    </div>
                    <div class="mb-3">
                        <label for="vm_vcpus" class="form-label">vCPUs</label>
                        <select class="form-select" id="vm_vcpus" name="vm_vcpus">
                            <!-- JavaScript가 옵션을 채웁니다. -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="vm_ram" class="form-label">RAM (GB)</label>
                        <select class="form-select" id="vm_ram" name="vm_ram">
                            <!-- JavaScript가 옵션을 채웁니다. -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="disk_size" class="form-label">Disk Size</label>
                        <select class="form-select" id="disk_size" name="disk_size">
                            <!-- JavaScript가 옵션을 채웁니다. -->
                        </select>
                    </div>
		    <div class="mb-3">
			<label for="vm_ip" class="form-label">VM IP</label>
			<input type="text" class="form-control" id="vm_ip" name="vm_ip" placeholder="Bastion의 IP를 입력하세요" required>
		    </div>
                    <button type="submit" name="action" value="create_vm" class="btn btn-danger">Bastion VM 생성 시작</button>
                </div>
            </div>
        </form>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--  [수정] 드롭다운 옵션을 동적으로 생성하는 스크립트 추가 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const vcpuSelect = document.getElementById('vm_vcpus');
            for (let i = 1; i <= 64; i++) {
                const option = new Option(i, i);
                if (i === 4) option.selected = true; // 기본값 4
                vcpuSelect.add(option);
            }

            const ramSelect = document.getElementById('vm_ram');
            for (let i = 2; i <= 64; i++) {
                const option = new Option(`${i} GB`, i);
                if (i === 16) option.selected = true; // 기본값 16
                ramSelect.add(option);
            }

            const diskSelect = document.getElementById('disk_size');
            for (let i = 100; i <= 2000; i += 100) {
                let label = `${i} GB`;
                if (i >= 1000) {
                    label = `${i / 1000} TB`;
                }
                const option = new Option(label, i);
                if (i === 300) option.selected = true; // 기본값 300
                diskSelect.add(option);
            }
        });
    </script>
</body>
</html>
